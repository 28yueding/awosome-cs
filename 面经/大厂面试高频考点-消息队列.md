给大家总结了大厂面试过程中高频的消息队列的题目，基本涵盖了主流的面试套路。

![](https://cdn.nlark.com/yuque/0/2022/png/640636/1646013071854-7f04a6f6-dda3-4b4f-9922-f63c76a9fa85.png)

# 什么时候应该使用消息队列

可以从如何几方面去回答：

1. 异步处理
2. 削峰填谷
3. 解耦

# 消息中间件技术选型

![](https://cdn.nlark.com/yuque/0/2022/png/640636/1646012448883-361563c7-30b1-4304-801f-f2a6a27795da.png)

# 消息队列的优缺点

1. 系统可用性
2. 系统复杂性变高
3. 一致性问题

# 如何保证消息队列的高可用

RabbitMQ 是比较有代表性的，因为是**基于主从**（非分布式）做高可用性的。RabbitMQ 有三种模式：单机模式、普通集群模式、镜像集群模式。

# 如何保证消息不被重复消费

消息幂等。

Kafka 实际上有个 offset 的概念，就是每个消息写进去，都有一个 offset，代表消息的序号，然后 consumer 消费了数据之后，**每隔一段时间**（定时定期），会把自己消费过的消息的 offset 提交一下，表示“我已经消费过了，下次我要是重启啥的，你就让我继续从上次消费到的 offset 来继续消费吧”。

# 如何保证消息的顺序性

Kafka是这么做的：

一个 topic，一个 partition，一个 consumer，内部单线程消费，单线程吞吐量太低，一般不会用这个。

写 N 个内存 queue，具有相同 key 的数据都到同一个内存 queue；然后对于 N 个线程，每个线程分别消费一个内存 queue 即可，这样就能保证顺序性。

# 如何保证消息的可靠传输

事务消息。

# 消息积压的时候如何处理

要考虑到消息的过期。

# 消息的传输机制

tcp。

# 如果让你设计一个消息的队列，应该怎么做，思路是什么

1. 伸缩性，快速扩容。参照一下 kafka 的设计理念，broker -> topic -> partition，每个 partition 放一个机器，就存一部分数据。如果现在资源不够了，给 topic 增加 partition，然后做数据迁移，增加机器，可以存放更多数据。
2. 消息需要落盘。写磁盘的效率。
3. 消息队列的高可用。多副本。
